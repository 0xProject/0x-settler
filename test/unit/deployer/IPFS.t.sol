// SPDX-License-Identifier: MIT
pragma solidity ^0.8.25;

import {IPFS} from "src/utils/IPFS.sol";

import "@forge-std/Test.sol";

contract IPFSTest is Test {
    function testF() public {
        bytes32 hash = 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff;
        string memory expected = "ipfs://QmfZy5bvk7a3DQAjCbGNtmrPXWkyVvPrdnZMyBZ5q5ieKG";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function testC() public {
        bytes32 hash = 0xcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc;
        string memory expected = "ipfs://Qmc871JZzbQq4r47Si29Fv1kAcJsmf3ccy4YyiahYXcesD";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function testA() public {
        bytes32 hash = 0xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa;
        string memory expected = "ipfs://QmZprxSLAFJgy9K2wTBzAg7yvg1Ucp9TH64gKQbn2ADKuB";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function test0() public {
        bytes32 hash = 0x00000000000000000000000000000000000000000000000000000000000000000;
        string memory expected = "ipfs://QmNLei78zWmzUdbeRB3CiUfAizWUrbeeZh5K1rhAQKCh51";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function testLong() public {
        string memory content =
            "{\"description\": \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean egestas turpis lectus, quis pellentesque quam egestas quis. Integer ante nisl, finibus vel malesuada ut, rutrum et mi. Quisque tristique quam sapien, nec fermentum diam dapibus quis. Nulla facilisi. Donec tincidunt arcu vitae velit posuere, sed vehicula tellus volutpat. Aliquam quis luctus turpis, eu facilisis ligula. Quisque aliquet ipsum in justo imperdiet finibus.  Ut non interdum diam. Nulla pharetra, nulla sed volutpat congue, urna quam pharetra nunc, nec fringilla nulla dui in nisl. Duis bibendum felis quam, sed aliquam neque imperdiet eu. Praesent vitae volutpat nunc. Morbi ac facilisis eros. Cras finibus, urna ut volutpat laoreet, lorem tortor lobortis dui, eu imperdiet nisi lectus sit amet massa. Vestibulum eu nulla ut augue eleifend tempus nec ac mi. Ut id odio augue. Pellentesque sodales dui orci, in volutpat ligula finibus ac.  Nullam hendrerit lobortis ipsum sit amet consectetur. Aenean vitae placerat dolor. In pharetra velit et mollis venenatis. Sed euismod auctor orci pulvinar pellentesque. Ut dignissim diam ut urna aliquet sagittis. Praesent mattis ultricies efficitur. Pellentesque consequat, sem ut finibus rhoncus, nunc ante tincidunt odio, vel efficitur ante purus sit amet purus. Ut dignissim urna suscipit suscipit ultricies. Mauris vestibulum, augue nec auctor tincidunt, diam tellus sodales diam, id accumsan neque tortor eget leo. Nulla maximus augue vitae imperdiet scelerisque.  Praesent venenatis leo non erat commodo ullamcorper. Morbi vel lacus nec nisl fermentum fermentum. Phasellus ornare orci neque, et aliquet risus viverra nec. Phasellus id metus ac neque dictum convallis in et neque. Cras fermentum massa id ante malesuada malesuada. Praesent sed fermentum metus, quis viverra nisl. Etiam vel nunc vestibulum, imperdiet urna vestibulum, luctus sem. Integer nec sollicitudin nisi, in iaculis sem.  Praesent quis augue porta, iaculis mi a, luctus nibh. Donec id maximus ante. Donec interdum sed est ac tristique. Vestibulum consequat lacus ultricies, convallis neque vel, mattis leo. Cras massa arcu, dignissim ac massa quis, lobortis imperdiet mi. Quisque quis tortor eu nulla molestie dictum. Donec vulputate hendrerit felis, congue eleifend nunc viverra at. Nulla consequat metus ut sapien aliquet vulputate. Integer tincidunt erat vestibulum pretium elementum. Aliquam euismod urna sit amet metus fermentum scelerisque lacinia quis lacus. Vivamus vel hendrerit nibh, sed pharetra turpis.  Nullam eu lectus ultricies, euismod arcu et, maximus nunc. Etiam ac mollis enim, nec pellentesque sem. Aliquam sed ullamcorper ante. Quisque ut odio mi. Maecenas rhoncus, ex blandit gravida condimentum, sapien ipsum ornare sem, ut tristique mi sapien efficitur urna. Nulla tempor vehicula ante a tempus. Praesent ac accumsan tellus, quis tincidunt quam. Suspendisse potenti. Curabitur ut convallis velit. Vivamus eu nulla ut massa facilisis semper. Sed pulvinar sodales mauris, a posuere ligula egestas nec. Quisque molestie pharetra tempus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Praesent nec libero sagittis, tincidunt lectus non, tincidunt nisi. Aenean vel elementum sem, vitae iaculis sem.  Praesent ultricies purus ut dolor faucibus auctor. Integer ut accumsan nunc. Nam consectetur, neque at vulputate imperdiet, velit mauris fermentum ante, finibus bibendum magna orci in libero. Proin efficitur sagittis tortor eu dignissim. Suspendisse venenatis auctor risus, eget eleifend lectus imperdiet eu. Pellentesque pretium, augue nec gravida dapibus, sapien ex efficitur justo, sit amet eleifend est quam ut mi. Cras facilisis ligula et sapien faucibus imperdiet. In finibus, enim pharetra imperdiet pellentesque, lectus lorem tincidunt nulla, vel feugiat massa velit vel justo. Aliquam tempus rutrum feugiat. Vestibulum in sodales urna. Cras vestibulum lacus eros, et ultrices tortor pulvinar non. Ut sit amet ultricies sem.  Proin a nulla eros. Sed porta tellus ante, id dignissim sem sagittis nec. Phasellus neque magna, cursus ac lacinia eget, sodales nec purus. Sed eget tristique enim, in lacinia ante. Nunc ex augue, vehicula id dapibus in, tincidunt sit amet odio. Maecenas id justo euismod, tristique nunc eget, dapibus quam. Nullam ipsum ligula, gravida sagittis elit vitae, pharetra pulvinar neque. Quisque ac mauris vitae dolor sodales ornare. Nullam mattis libero dolor, sit amet porttitor ipsum bibendum a. Integer imperdiet ultrices tincidunt. Nullam id mauris elementum, elementum orci non, sodales ex. Etiam euismod nunc et dignissim aliquam. Morbi pellentesque erat velit, imperdiet sollicitudin nunc placerat sed. Nullam enim tellus, tempus et lorem nec, convallis mollis urna.  Morbi quis purus faucibus, tristique velit sit amet, tempor lacus. Sed consectetur scelerisque cursus. Duis lacinia rutrum convallis. Sed in commodo neque. Sed vel lacus eu nisi scelerisque finibus. Quisque scelerisque ultrices libero eu fringilla. Pellentesque eget varius ligula, eu porta nibh. Suspendisse porta varius ex, tempus posuere purus viverra sed. Nulla eget arcu condimentum, dignissim dolor id, pellentesque risus. Cras in sem eu libero tempus ultrices. Praesent at facilisis erat. Nulla facilisi.  Cras commodo sed elit sed porta. Vivamus libero lacus, bibendum sit amet viverra sit amet, cursus a felis. Nunc vel malesuada nisl. Donec sodales nunc ut sagittis viverra. Morbi venenatis ullamcorper scelerisque. Sed bibendum orci ac elementum lacinia. Praesent a dui dolor. Nullam vitae arcu id neque tincidunt molestie et et nisi.  Phasellus posuere nulla et massa volutpat, a fringilla lacus interdum. Aenean sed urna at quam sagittis congue eget ac arcu. Suspendisse in diam iaculis, pellentesque lectus non, feugiat velit. Cras faucibus ex neque, vitae mollis quam ultricies in. Vivamus laoreet, ipsum eget lobortis accumsan, mauris augue rutrum sapien, at ultricies nunc velit ut tortor. In eget ullamcorper quam. Ut in dolor dapibus, vulputate ligula ut, condimentum velit. Nulla sed sem accumsan, imperdiet nisl et, ultrices est. Ut sed dignissim dolor, at finibus eros. Vivamus laoreet pellentesque sodales. Integer risus justo, mollis eu posuere ut, pharetra quis mi.  In fringilla nisl vulputate congue viverra. Suspendisse sit amet mattis lacus, sed vulputate sapien. Nullam porta facilisis orci et egestas. Nulla ac dignissim lacus. Suspendisse mattis diam sit amet lectus sollicitudin accumsan. Praesent varius neque felis, sit amet fringilla lacus blandit at. Quisque eu sapien nisi. Sed mauris nisl, hendrerit non justo ut, pulvinar interdum diam. Nunc eget felis ut turpis eleifend ultrices quis tempus massa. Donec ornare nec leo vel convallis. Curabitur in mi quis felis congue pellentesque vitae dignissim odio. Nulla vehicula sollicitudin diam. Mauris viverra quam velit, in commodo tellus laoreet ac. Quisque laoreet, sapien at interdum interdum, magna nunc facilisis lacus, ut aliquet arcu turpis porttitor leo. Nam dictum urna lorem, quis tincidunt sem vehicula a.  Aliquam posuere arcu neque, in tristique augue finibus id. Morbi varius porta aliquet. Vestibulum venenatis lorem sapien, sit amet pellentesque nulla suscipit eu. Donec in luctus felis. Etiam pretium lectus vel justo lacinia, id aliquam erat condimentum. Pellentesque commodo pulvinar rutrum. Proin sit amet sapien at sem placerat cursus et vel risus. Integer a rhoncus tortor, eu gravida mauris. Proin finibus elementum libero in sollicitudin. Vestibulum fermentum fringilla rhoncus. Suspendisse potenti. Phasellus vitae posuere lorem, a convallis leo.  Duis pellentesque ex sit amet lectus vehicula, ac laoreet urna pretium. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Phasellus imperdiet sem a metus faucibus dapibus. Suspendisse justo erat, sagittis ut nibh sed, eleifend efficitur dolor. Phasellus et tellus ipsum. Cras congue tellus lectus, eget elementum lacus fringilla eu. Sed vestibulum fringilla metus. Nulla fermentum leo ac erat luctus molestie sit amet ut enim. Vestibulum nibh risus, dictum ac turpis ut, interdum vulputate risus. Integer lectus metus, varius sit amet arcu sed, dapibus malesuada purus. Integer sit amet odio rutrum, pulvinar arcu quis, ullamcorper arcu. In nisl tellus, aliquet et ex et, venenatis hendrerit nisl. Donec euismod enim pretium, interdum ante in, malesuada sapien. Integer lobortis porta ipsum et finibus. Aliquam id fringilla turpis, nec aliquet metus.  Proin quis interdum odio. In et finibus tellus, et cursus massa. Phasellus ac ultrices risus. Nunc ac ornare dui. Integer id nisl a sapien ullamcorper hendrerit a non leo. Praesent vehicula condimentum felis eu imperdiet. Aenean at mollis nulla. Morbi porta tristique ex, eget ullamcorper lacus lobortis vel. Nullam quis lobortis nibh. Nullam at malesuada ex, sit amet tempus diam. Nunc a lorem finibus, placerat elit in, varius est. Vestibulum eget mollis magna. Cras blandit vestibulum finibus.  Donec ornare viverra nisl ac laoreet. Aliquam quis elementum ipsum. Nullam id sem et orci ullamcorper aliquet. Donec placerat nisl vel sem egestas dapibus. Nulla magna dui, placerat vulputate volutpat non, tincidunt sit amet neque. Duis blandit magna metus, non consequat quam sollicitudin vel. Curabitur eleifend rutrum sem a viverra. Duis eget lobortis orci. Fusce sed vehicula metus.  Nunc aliquam justo non ante mattis vestibulum. Mauris nulla turpis, pulvinar eget urna at, fringilla pretium sem. Suspendisse quis libero pellentesque, lobortis massa a, lobortis metus. Suspendisse nec tortor eleifend nunc ultrices interdum et vel ante. Mauris eu massa varius, tempus arcu in, faucibus neque. In euismod tortor lacus, ut finibus dolor condimentum quis. Nulla ut cursus arcu, ac condimentum sapien. Sed eu sagittis urna, vitae ullamcorper velit. Curabitur pretium elementum ex non lobortis. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Duis vehicula nulla nec diam placerat, mattis tincidunt nisl scelerisque. Duis eu vestibulum nisi, in feugiat nisi.  Sed id varius augue. In non commodo ex, sit amet pulvinar urna. Phasellus non elit feugiat magna suscipit eleifend. Curabitur ac nunc facilisis, aliquet arcu et, pharetra metus. Duis vulputate felis at egestas dapibus. Integer feugiat elit eu metus pellentesque pretium. Suspendisse non risus laoreet, consequat nunc ac, eleifend tortor.  Duis in bibendum nunc. Aliquam a gravida dui. Duis facilisis malesuada tellus vitae fermentum. Integer faucibus turpis ac nibh fringilla sagittis. Vivamus suscipit mattis arcu ut rhoncus. Donec malesuada mauris et augue scelerisque, at bibendum enim commodo. Nullam ornare augue vel ultricies fermentum. Ut at enim ut orci malesuada commodo. Fusce cursus nunc mi, quis elementum neque interdum a. Donec sit amet pellentesque ligula. Suspendisse efficitur nec nulla in hendrerit.  Etiam elementum ex ut lorem consectetur finibus. Proin in finibus ex. Maecenas lacinia, turpis quis consequat bibendum, velit tortor vestibulum nisl, id sodales risus quam aliquet odio. Phasellus metus urna, gravida id metus a, volutpat fermentum sapien. Ut nec porttitor arcu. Suspendisse potenti. Vestibulum quis tempor sem. Curabitur velit orci, consequat ac commodo sed, dictum eget felis. Donec id ullamcorper nulla. Nullam egestas tortor ac nisi pulvinar, ac tincidunt quam ultrices. Fusce tempus leo ut rhoncus pulvinar. Vestibulum vitae elit sed eros tincidunt semper quis sit amet lorem. Ut at magna vitae elit congue eleifend vel at nibh.  Curabitur pharetra ultricies ultrices. Maecenas pulvinar nulla sed diam auctor tincidunt. Maecenas iaculis eleifend lorem eget bibendum. Nulla a nulla cursus, porta ex id, euismod arcu. Vivamus vestibulum dignissim justo in iaculis. Aenean bibendum mauris ac nisl laoreet feugiat. Aliquam tincidunt metus ex, id bibendum est bibendum at. Curabitur nulla neque, aliquam non consequat quis, rutrum at enim. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam auctor est ac bibendum commodo. Aliquam sit amet ipsum vestibulum, facilisis nunc vel, molestie est. Suspendisse eget erat metus.  Fusce malesuada ante turpis, eget facilisis mauris condimentum vel. Aenean id placerat felis. Praesent imperdiet sapien sed massa malesuada, ac sodales purus fringilla. Sed non imperdiet nisl. Suspendisse potenti. Nam euismod vehicula eros, nec venenatis ex sodales et. Suspendisse facilisis congue ante, sit amet aliquam leo. Morbi ante enim, pulvinar et enim non, hendrerit varius risus. Donec porta odio vitae molestie mattis. Curabitur urna massa, tempus non elementum non, tincidunt non magna.  Mauris eu lacus volutpat, blandit eros ut, dictum orci. Aliquam pretium tellus et aliquet sollicitudin. Etiam fringilla, ipsum quis semper varius, ligula ipsum mollis ex, id pulvinar ligula ipsum vitae tellus. Nulla facilisis massa id justo elementum imperdiet eget sit amet enim. Suspendisse gravida libero at laoreet pellentesque. Fusce nec consequat magna. Duis mattis sapien sed enim varius, volutpat convallis justo pellentesque. Fusce blandit enim ultrices diam tincidunt commodo. Quisque et porta velit. Vivamus vestibulum scelerisque orci, non tempus lorem egestas quis. Nam ac nisl est. Nam eros ex, eleifend non pellentesque fermentum, sagittis et metus. Mauris urna sapien, scelerisque a malesuada eu, facilisis et velit. Maecenas vitae sagittis dolor.  Vestibulum vitae ante nec justo pellentesque tempus. Pellentesque vel turpis vel diam semper varius. Proin mauris lectus, molestie ac ullamcorper sit amet, venenatis sit amet turpis. Aliquam ornare eget nisl at lobortis. Nullam ullamcorper felis sed porttitor finibus. Nunc elementum gravida ultricies. Donec sed gravida augue.  Maecenas viverra faucibus odio. Phasellus urna odio, finibus sed ornare et, feugiat quis orci. Maecenas luctus velit gravida condimentum euismod. Nullam rutrum justo feugiat tortor scelerisque, eu maximus eros hendrerit. Aenean sagittis neque in metus vulputate, non scelerisque nunc pulvinar. Fusce et sodales metus. Nullam mattis, felis id faucibus aliquet, velit nibh ornare augue, nec efficitur elit libero et nisl. Vivamus finibus massa sem, sed aliquet nulla auctor id. Proin dictum, nulla non sodales malesuada, mauris dolor feugiat dolor, id mattis eros quam id purus. Aenean ut aliquam velit. Sed ornare tincidunt ex, non venenatis massa. Sed elit metus, bibendum eget lacus in, auctor sagittis sapien. Phasellus pellentesque vestibulum sagittis. Pellentesque blandit facilisis tempus.  Maecenas sed nibh erat. Nam eu sagittis libero. Etiam tristique elementum maximus. Mauris ligula arcu, blandit a metus sed, vehicula finibus dolor. Sed non mi quam. Curabitur imperdiet lacus vel dolor cursus tristique. Mauris a posuere nulla. Duis id dignissim dui. Quisque et dui egestas, mollis erat quis, consectetur magna. Aenean ex nunc, fermentum quis dui a, pulvinar sollicitudin augue. Curabitur porttitor vestibulum fringilla. Ut posuere laoreet eros id faucibus. Cras fringilla malesuada ante, laoreet efficitur purus varius vel.  Vestibulum non libero quis ante finibus elementum eget ut risus. Nunc tincidunt luctus diam sed lobortis. Curabitur venenatis ultricies nulla. Cras sit amet enim suscipit, iaculis libero sed, sodales nibh. Aliquam eget vulputate nulla. Sed varius odio ante, ac aliquet sem ultricies ut. Pellentesque congue at elit nec commodo. Donec lacus turpis, dictum ut velit in, imperdiet vulputate ipsum. Quisque id placerat urna. Donec commodo tellus purus, vel aliquam tellus blandit vehicula.  Suspendisse neque ipsum, porta eget mauris quis, eleifend consectetur ligula. Integer nec accumsan velit. Aenean pulvinar purus vel nunc mollis tristique. Sed non consectetur nunc. Pellentesque lobortis eleifend porttitor. Duis eu condimentum tortor. Donec scelerisque ultricies erat. Nam accumsan nisl nisi, sit amet volutpat tortor hendrerit ac. Nulla non mattis enim, eget ultricies sem. In fringilla imperdiet turpis, semper euismod odio facilisis sed. Cras tincidunt, diam vitae dictum scelerisque, lacus sapien lobortis velit, finibus consectetur mi turpis eget ipsum. Integer scelerisque volutpat eros, eget tristique est bibendum eu. Sed ut fermentum libero.  Aenean ac semper magna, nec tincidunt lectus. Fusce sed bibendum purus. Vestibulum varius tellus eu ligula efficitur, non vehicula magna sollicitudin. Donec non lectus quis magna consectetur posuere. Praesent egestas laoreet risus et pulvinar. Nullam nec facilisis nulla. Vestibulum tristique sem ultrices, scelerisque odio nec, vulputate risus. Sed ultrices lacus ex, nec malesuada est blandit nec. Quisque quam purus, dictum quis tellus mattis, ornare tristique est. Praesent condimentum scelerisque elit, in vulputate felis vestibulum id. Suspendisse ac tincidunt sapien. Donec laoreet massa sed scelerisque posuere. Phasellus gravida convallis neque, eleifend egestas risus hendrerit id. Fusce quam tortor, sodales in lacinia pretium, fringilla at ipsum.  Sed ex mauris, gravida in consectetur quis, scelerisque in ligula. Duis eu est vel nisi fringilla elementum sit amet ut nisi. Quisque luctus dapibus pharetra. In velit eros, rutrum nec elementum aliquet, consequat vitae velit. Praesent bibendum viverra nisl interdum facilisis. Nam ex diam, viverra sed tempus sit amet, euismod eget nunc. Vestibulum ornare ex quis auctor euismod. Nullam vel ultricies justo, nec vehicula mauris. Donec in ornare neque, in ultrices metus. \", \"name\": \"0xV5\"}\n";
        bytes32 hash = IPFS.dagPbUnixFsHash(content);
        string memory expected = "ipfs://QmYXyxhR59kCfioY3ms93BxDYsFZUYSYM8xqGhZfaP2S1A";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function testEmpty() public {
        bytes32 hash = IPFS.dagPbUnixFsHash("");
        string memory expected = "ipfs://QmbFMke1KXqnYyBBWxB74N4c5SBnJMVAiMNRcGu6x1AwQH";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function testHelloWorld() public {
        bytes32 hash = IPFS.dagPbUnixFsHash("Hello, World!\n");
        string memory expected = "ipfs://QmYAXgX8ARiriupMQsbGXtKdDyGzWry1YV3sycKw1qqmgH";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }

    function testReallyLong() public {
        string memory content; // 128 kiB of "a"
        assembly ("memory-safe") {
            content := mload(0x40)
            mstore(content, 0x20000)
            for {
                let i := add(content, 0x20)
                let end := add(i, mload(content))
            } lt(i, end) { i := add(i, 0x20) } {
                mstore(i, 0x6161616161616161616161616161616161616161616161616161616161616161)
            }
            mstore(0x40, add(content, 0x20020))
        }
        bytes32 hash = IPFS.dagPbUnixFsHash(content);
        string memory expected = "ipfs://QmViWeVfyAUMZWJGQQsmK3xwAcuaCDLpSmPo9kXzJ9gyEc";
        string memory actual = IPFS.CIDv0(hash);
        assertEq(keccak256(bytes(actual)), keccak256(bytes(expected)));
    }
}
